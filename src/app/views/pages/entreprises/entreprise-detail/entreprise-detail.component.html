<tf-portlet class="tf-portlet--height-fluid mat-elevation-z8" id="portlet-entreprise" *ngIf="entreprise">
	<div class="tf-portlet-header ">
		<span class="title">
			<a [routerLink]="['/entreprises/list']">{{'MENU.SUB_ENTREPRISES.LIST' | translate}}</a><span class="divider">></span><span class="id-item">{{entreprise.raison_sociale}}</span>
		</span>
		<div ngbDropdown placement="bottom-right" class="d-inline-block pull-right">
			<button ngbDropdownToggle mat-icon-button color="primary" matTooltip="Actions" style="line-height: 0;height: 0;">
				<mat-icon>more_vert</mat-icon>
			</button>
			<div ngbDropdownMenu class="dropdown-menu dropdown-menu-anim dropdown-menu-top-unround " style="min-width: max-content; padding: 5px;">
				<button mat-icon-button color="info" matTooltip="{{'ACTION.EDIT' | translate}}" (click)="editEntreprise(entreprise.id)">
					<mat-icon>edit</mat-icon>
				</button>
				<button mat-icon-button color="warn" matTooltip="{{'ACTION.DELETE' | translate}}" (click)="deleteEntreprise(entreprise.id)">
					<mat-icon>delete</mat-icon>
				</button>
			</div>
		</div>
	</div>
	<tf-portlet-body class="tf-portlet__body--fit">
		<div class="row">
			<div class="col-md-4">
				<div class="card">
					<h3>Informations générales</h3>
					<div class="box" style="flex:1">
						<p><span class="label pull-left mr-2">{{'EES.RAISON_SOCIALE.TITLE' | translate}}</span><span class="">{{entreprise.raison_sociale}}</span></p>
						<p><span class="label pull-left mr-2">{{'EES.TYPE.TITLE' | translate}}</span><span class="">{{entreprise.type?.libelle}}</span></p>
					</div>
					<div class="tf-divider">
						<span></span>
					</div>
					<div class="box text-center">
						<small>{{'COMMON.CREATED_AT.TITLE' | translate}} : {{entreprise.created_at | date:'dd/MM/yyyy'}}</small><br>
						<small>{{'COMMON.UPDATED_AT.TITLE' | translate}} : {{entreprise.updated_at | date:'dd/MM/yyyy'}}</small>
					</div>
				</div>
			</div>
			<div class="col-md-8">
				<div class="card">
					<h3>Coordonnées entreprise</h3>
					<div class="box box-coords" style="flex:1">
						<p><span class="label pull-left mr-2">{{'COMMON.ADRESS.SHORTTITLE' | translate}}</span><span class="">{{entreprise.adresse ? entreprise.adresse : '&nbsp;'}}</span></p>
						<p><span class="label pull-left mr-2">{{'COMMON.CITY.SHORTTITLE' | translate}}</span><span class="">{{entreprise.ville ? entreprise.ville : '&nbsp;'}}</span></p>
						<p><span class="label pull-left mr-2">{{'COMMON.POSTCODE.SHORTTITLE' | translate}}</span><span class="">{{entreprise.code_postal ? entreprise.code_postal : '&nbsp;'}}</span></p>
						<p><span class="label pull-left mr-2">{{'COMMON.COUNTRY.SHORTTITLE' | translate}}</span><span class="">{{entreprise.pays ? entreprise.pays : '&nbsp;'}}</span></p>
					</div>
				</div>
			</div>
			<div class="col-md-12 mt-4">
				<div class="card">
					<h3>Suivi de l'entreprise</h3>
					<div class="box box-chantiers " style="flex: 1;">
						<h5><b>Suivis chantiers</b><small class="pull-right">{{'EES.CHANTIERS_COUNT.SHORTTITLE' | translate}} : <span class="blue">{{entreprise.chantiers.length}}</span></small></h5>
						<div class="row mt-4" *ngIf="entreprise.chantiers.length > 0; else noChantier">
							<div class="col-md-12">
		            <div class="table-responsive">
                  <table mat-table [dataSource]="entreprise.chantiers" class="table-sm">
                    <!-- number Column -->
                    <ng-container matColumnDef="number">
                      <th mat-header-cell *matHeaderCellDef>{{'CHANTIERS.NUMBER.SHORTTITLE' | translate}}</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="pointer"> {{chantier.numero}} </td>
                    </ng-container>
  
                    <!-- name Column -->
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef>{{'CHANTIERS.NAME.TITLE' | translate}}</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="pointer"> {{chantier.nom}} </td>
                    </ng-container>
  
                    <!-- client Column -->
                    <ng-container matColumnDef="client">
                      <th mat-header-cell *matHeaderCellDef>{{'CHANTIERS.CLIENT.TITLE' | translate}}</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="pointer"> {{chantier.client | truncate:35}} </td>
                    </ng-container>
  
                    <!-- status Column -->
                    <ng-container matColumnDef="status">
                      <th mat-header-cell *matHeaderCellDef class="text-center">{{'CHANTIERS.STATUS.SHORTTITLE' | translate}}</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="text-center pointer" [ngStyle]="chantier.status && chantier.status.color && {'color':chantier.status.color}"> {{chantier.status?.libelle}} </td>
                    </ng-container>
  
                    <!-- charge_affaire Column -->
                    <ng-container matColumnDef="charge_affaire">
                      <th mat-header-cell *matHeaderCellDef class="text-center">{{'CHANTIERS.CHIEF.TITLE' | translate}}</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="text-center pointer">
                        <div [matTooltipClass]="'custom-tooltip'" matTooltip="{{chantier.charge_affaire | fullName}}" [matTooltipShowDelay]="'100'" [matTooltipHideDelay]="'100'" [matTooltipPosition]="'above'">
                          {{chantier.charge_affaire?.trigramme}}
                        </div>
                      </td>
                    </ng-container>
                    <!-- date_demarrage Column -->
                    <ng-container matColumnDef="date_demarrage">
                      <th mat-header-cell *matHeaderCellDef class="text-center">{{'CHANTIERS.DATE_DEMARRAGE.SHORTTITLE' | translate}} Chantier</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="text-center pointer"> {{chantier.date_demarrage | date:'dd/MM/yyyy'}} </td>
                    </ng-container>
                    <!-- date_demarrage_ee Column -->
                    <ng-container matColumnDef="date_demarrage_ee">
                      <th mat-header-cell *matHeaderCellDef class="text-center">{{'EES.DATE_DEMARRAGE.SHORTTITLE' | translate}} de l'EE</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="text-center pointer"> {{chantier.pivot.date_demarrage | date:'dd/MM/yyyy'}} </td>
                    </ng-container>
                    <!-- ca_ee Column -->
                    <ng-container matColumnDef="ca_ee">
                      <th mat-header-cell *matHeaderCellDef class="text-center">{{'EES.CA.SHORTTITLE' | translate}} de l'EE</th>
                      <td mat-cell *matCellDef="let chantier" (click)="viewChantier(chantier.id)" class="text-center pointer"> {{chantier.pivot.chiffre_affaire | currency:'EUR':'€'}} </td>
                    </ng-container>
  
                    <tr mat-header-row *matHeaderRowDef="displayedEEChantiersColumns"></tr>
                    <tr mat-row class="highlight-row" *matRowDef="let row; columns: displayedEEChantiersColumns;"></tr>
                    
                  </table>
                </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</tf-portlet-body>
</tf-portlet>


<ng-template #noChantier>
		<p class="text-left">
			Cette entreprise n'a été affectée à aucun chantier
		</p>
</ng-template>
