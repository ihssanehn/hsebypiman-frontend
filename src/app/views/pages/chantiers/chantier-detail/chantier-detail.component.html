<div class="row row-filters" style="height: 69px;">
  
</div>
<tf-portlet class="tf-portlet--height-fluid mat-elevation-z8" id="portlet-chantier" *ngIf="chantier">
  <div class="tf-portlet-header ">
    <span class="title">
      <a [routerLink]="['/chantiers/list']">Liste des chantiers</a><span class="divider">></span><span class="id-item">{{chantier.nom}}</span>
    </span>
  </div>
  <tf-portlet-body class="tf-portlet__body--fit">
    <div class="row">
      
      
      <div class="col-md-4">
        <div class="card">
          <h3>Status actuel du chantier</h3>
          <div class="box box-status">
            <mat-icon svgIcon="{{chantier.status?.code == 'ENCOURS' ? 'status-encours':'status-termine'}}" style="width:100px;height:100px"></mat-icon>
            <h2>{{chantier.status?.libelle}}</h2>
          </div>
          <div class="tf-divider">
						<span></span>
          </div>
          <div class="box box-coords">
            <h5><b>Coordonnées</b> chantier</h5>
            <p><span class="label mr-2">Nom</span><span class="pull-right">{{chantier.nom}}</span></p>
            <p><span class="label mr-2">Adresse</span><span class="pull-right">{{chantier.adresse}}</span></p>
            <p><span class="label mr-2">Ville</span><span class="pull-right">{{chantier.ville}}</span></p>
            <p><span class="label mr-2">Code postal</span><span class="pull-right">{{chantier.code_postal}}</span></p>
            <p><span class="label mr-2">Pays</span><span class="pull-right">{{chantier.pays}}</span></p>
          </div>
          <div class="tf-divider">
            <span></span>
          </div>
          <div class="box text-center">
            <small>mise a jour des informations : {{chantier.updated_at | date:'dd/MM/yyyy'}}</small>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <h3>Information CVTI</h3>
          <div class="box">
            <p><span class="label">Date de démarrage chantier</span><br>{{chantier.date_demarrage}}</p>
            <p><span class="label">Nom du salarié réalisant la visite commune</span><br>{{chantier.latest_ar.realisateur}}</p>
          </div>
          <div class="box">
            <h5><b>En cas</b> d'urgence</h5>
            <p><span class="label mr-2">En cas d'accident ou incendit</span><br><span class="blue">{{chantier.latest_ar.num_secours}}</span></p>
            <p><span class="label mr-2">Personne CVTI en cas d'accident</span><br><span class="blue">{{chantier.latest_ar.contact_interne_secours}}</span></p>
            <p><span class="label mr-2">Numéro de la personne CVTI</span><br><span class="blue">{{chantier.latest_ar.tel_contact_interne_secours}}</span></p>
          </div>
        </div>
      </div>
      <div class="col-md-5">
        <div class="card">
          <h3>Information générale</h3>
          <div class="box">
            <div class="row">
              <div class="col-md-6">
                <h5><b>Client</b></h5>
                <p><span class="label mr-2">Nom</span><span class="pull-right">{{chantier.client}}</span></p>
              </div>
              <div class="col-md-6">
                <h5><b>Chargé d'affaire</b></h5>
                <p><span class="label mr-2">Nom</span><span class="pull-right">{{chantier.charge_affaire | fullName}}</span></p>
              </div>
            </div>
          </div>
          <div class="box">  
            <div class="row">
              <div class="col-md-6">
                <h5><b>Budget</b></h5>
                <p><span class="label mr-2">Montant</span><span class="pull-right">{{chantier.montant | currency:'EUR':'€'}}</span></p>
              </div>
              <div class="col-md-6">
                <h5><b>Type de chantier</b></h5>
                <p><span class="label mr-2">Type</span><span class="pull-right">{{chantier.type?.libelle}}</span></p>
              </div>
            </div>
          </div>
          
          <div class="tf-divider h-5">
            <span></span>
          </div>
          <div class="box box-ar-vs">
            <h5><b>Suivis analyses de risques</b><span class="pull-right">Nb d'analyses : <span class="blue">{{chantier.ars.length}}</span></span></h5>
            <div class="row">
              <div class="col-md-6"><p><span class="label mr-2">Prochaine anayse de prévue</span></p></div>
              <div class="col-md-6"><p  class="text-right blue">{{chantier.latest_ar?.date_validite | date:'dd/MM/yyyy'}}</p></div>
            </div>
            <div class="row">
              <div class="col-md-6"><p><span class="label mr-2">Analyses passées</span></p></div>
              <div class="col-md-6"><p class="text-right" *ngFor="let ar of chantier.ars">{{ar.date | date:'dd/MM/yyyy'}}</p></div>
            </div>
          </div>
          <div class="box box-ar-vs">
            <h5><b>Suivis visites de sécurité</b><span class="pull-right">Nb de visites : <span class="blue">{{chantier.vss.length}}</span></span></h5>
            <div class="row">
              <div class="col-md-6"><p><span class="label mr-2">Prochaine visite de prévue</span></p></div>
              <div class="col-md-6"><p  class="text-right blue">{{chantier.latest_vs?.date_validite | date:'dd/MM/yyyy'}}</p></div>
            </div>
            <div class="row">
              <div class="col-md-6"><p><span class="label mr-2">Visites passées</span></p></div>
              <div class="col-md-6"><p class="text-right" *ngFor="let vs of chantier.vss">{{vs.date | date:'dd/MM/yyyy'}}</p></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </tf-portlet-body>
</tf-portlet>