<ng-container [formGroup]="demandeEpisForm">
	<tf-portlet-body>
		<div class="tf-heading tf-heading--lg" style="margin-top: 0;">
			<div *ngIf="edit">
				{{'MENU.SUB_DEMANDES_EPIS.EDIT' | translate}}
			</div>
			<span *ngIf="!edit">{{'MENU.SUB_DEMANDEs_EPIS.ADD' | translate}}</span>
		</div>
		<div>
			<div class="tf-wizard-v4__content" data-tfwizard-type="step-content" data-tfwizard-state="current">
				<div class="tf-form__section tf-form__section--first">
					<div class="tf-wizard-v4__form">
						<div class="row form-row">
							<div class="col-12">
								<ng-container formArrayName="epis">
									<div class="card card-custom p-4 mb-4"  *ngFor="let epi of epis.controls; index as i">
										<div class="row d-flex justify-content-end">
											<button mat-icon-button color="warn" type="button" (click)="removeEpi(i)">
												<mat-icon>delete</mat-icon>
											</button>
										</div>
										<div class="row form-row">
											<ng-container [formGroupName]="i">
												<div class="col-6">
													<tf-tree-select [itemsList]="categoriesList" [fromId]="epi.get('categorie_id').value" [required]="true" [withAll]="false" [translateTitle]="'MATERIELS.CATEGORIE'" [itemsToHandle]="itemsToHandle" (onChangedItem)="categorieChanged($event, i)" (onSelectedItemsToHandle)="itemsToHandleSelected($event, i)" *ngIf="categoriesList" [fromSource]="false"></tf-tree-select>
												</div>
												<mat-form-field class="col-2 offset-2">
													<mat-label>{{'DEMANDES_EPIS.QTE' | translate}}</mat-label>
													<input class="form-control" matInput type="number" min="1" name="qte" formControlName="qte" placeholder="{{'ACTION.ENTER_HERE' | translate}}" [required]="isFieldRequired('qte')" />
													<mat-error *ngIf="isControlHasError('qte','required')">
														<strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
													</mat-error>
													<mat-error *ngIf="isControlHasError('qte','min')">
														<strong>{{ 'AUTH.VALIDATION.MINIMAL_QUANTITY' | translate }}</strong>
													</mat-error>
												</mat-form-field>
												<mat-form-field class="col-12">
													<mat-label>{{'DEMANDES_EPIS.COMMENT' | translate}}</mat-label>
													<textarea class="form-control" matInput type="text" name="comment" formControlName="comment" placeholder="{{'ACTION.ENTER_HERE' | translate}}" [required]="isFieldRequired('comment')" ></textarea>
													<mat-error *ngIf="isControlHasError('comment','required')">
														<strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
													</mat-error>
												</mat-form-field>
											</ng-container>
										</div>
									</div>
								</ng-container>
							</div>
							<div class="col-12 text-center">
								<button type="button" mat-raised-button color="info" (click)="addEpi()">Ajouter un EPI</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</tf-portlet-body>
</ng-container>
