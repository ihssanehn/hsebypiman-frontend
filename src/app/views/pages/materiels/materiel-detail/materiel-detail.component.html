<tf-portlet class="tf-portlet--height-fluid mat-elevation-z8" id="portlet-materiel" *ngIf="materiel">
	<div class="tf-portlet-header ">
		<span class="title">
			<a [routerLink]="['/materiel/list']">{{'MENU.SUB_MATERIELS.LIST' | translate}}</a><span class="divider">></span><span class="id-item">{{materiel.libelle}}</span>
		</span>
		<div ngbDropdown placement="bottom-right" class="d-inline-block pull-right">
			<button ngbDropdownToggle mat-icon-button color="primary" matTooltip="Actions" style="line-height: 0;height: 0;">
				<mat-icon>more_vert</mat-icon>
			</button>
			<div ngbDropdownMenu class="dropdown-menu dropdown-menu-anim dropdown-menu-top-unround " style="min-width: max-content; padding: 5px;">
				<ng-container *ngxPermissionsOnly="['materiel_canUpdate']">
					<button *ngIf="materiel.main_categorie?.code != 'VEHICULE'" mat-icon-button color="info" matTooltip="{{'ACTION.EDIT' | translate}}" (click)="editMateriel(materiel.id)">
						<mat-icon>edit</mat-icon>
					</button>
				</ng-container>
				<button mat-icon-button color="warn" matTooltip="{{'ACTION.DELETE' | translate}}" (click)="deleteMateriel(materiel.id)" *ngxPermissionsOnly="['materiel_canArchieve']">
					<mat-icon>delete</mat-icon>
				</button>
			</div>
		</div>
	</div>
	<tf-portlet-body class="tf-portlet__body--fit" *ngIf="materiel">
		<div class="row">
			<div class="col-md-5">
				<div class="card">
					<h3>{{'MATERIELS.CARD.GENERAL_INFOS.TITLE' | translate}}</h3>
					<div class="box" style="flex:1">
						<p><span class="label pull-left mr-2">{{'MATERIELS.LIBELLE.TITLE' | translate}}</span><span *ngIf="materiel.libelle; else noData">{{materiel.libelle}}</span></p>
						<p><span class="label pull-left mr-2">{{'MATERIELS.NUMERO_SERIE.TITLE' | translate}}</span><span *ngIf="materiel.numero_serie; else noData">{{materiel.numero_serie}}</span></p>
						<p><span class="label pull-left mr-2">{{'MATERIELS.CATEGORIE.TITLE' | translate}}</span><span *ngIf="materiel.flat_categories; else noData">
								<span *ngFor="let cat of materiel.flat_categories; let last = last;">
									{{cat.libelle}}<span *ngIf="!last"> / </span>
								</span>
							</span></p>
						<p><span class="label pull-left mr-2">{{'MATERIELS.DATE_ENTREE.TITLE' | translate}}</span><span *ngIf="materiel.date_entree; else noData">{{materiel.date_entree | date:'dd/MM/yyyy'}}</span></p>
						<p><span class="label pull-left mr-2">{{'MATERIELS.HAS_CONTROLE.TITLE' | translate}}</span><span>{{materiel.has_controle == 1 ? 'oui': 'non'}}</span></p>
						<p><span class="label pull-left mr-2">{{'MATERIELS.DESCRIPTION.TITLE' | translate}}</span><span *ngIf="materiel.description; else noData">{{materiel.description}}</span></p>
						<ng-template #noData>
							<span>-</span>
						</ng-template>
					</div>
					<div class="tf-divider">
						<span></span>
					</div>
					<div class="box text-center">
						<small>{{'COMMON.CREATED_AT.TITLE' | translate}} : {{materiel.created_at | date:'dd/MM/yyyy'}}</small><br>
						<small>{{'COMMON.UPDATED_AT.TITLE' | translate}} : {{materiel.updated_at | date:'dd/MM/yyyy'}}</small>
					</div>
				</div>
			</div>
			<div class="col-md-7">
				<div class="cards">
					<div class="card">
						<div class="box box-ar-vs" style="flex: 1;">
							<h5><b>{{'MATERIELS.CARD.USER_TRACKING.TITLE' | translate}}</b><small class="pull-right">{{'MATERIELS.PERSONNELS_COUNT.SHORTTITLE' | translate}} : <span class="blue">{{materiel.salaries.length}}</span></small></h5>
							<ng-container *ngIf="materiel.salaries.length > 0; else noSalaries">
								<div class="row">
									<div class="col-12 my-2">
										<p><span class="label">{{'MATERIELS.ACTUAL_USER.TITLE' | translate}}</span></p>
									</div>
									<ng-container *ngIf="materiel.actual_user; else noUserInProgress">
										<div class="col-4">
											<p class="blue text-left">{{materiel.actual_user | fullName}}</p>
										</div>
										<div class="col-3">
											<p class="blue text-center">{{'MATERIELS.READY.TITLE' | translate}} : {{materiel.actual_user?.pivot.date_pret | date:'dd/MM/yyyy'}}</p>
										</div>
										<div class="col-3">
	
										</div>
										<div class="col-2">
											<a class="pull-right" (click)="goToUserDetail(materiel.actual_user.id)" matTooltip="{{'ACTION.SHOW_USER' | translate}}">
												<mat-icon color="primary">visibility</mat-icon>
											</a>
										</div>
	
										<div class="col-12" *ngIf="materiel.main_categorie?.code != 'VEHICULE'">
											<button mat-raised-button class="btn-small pull-right" color="info" (click)="$event.stopPropagation(); openPretModal('return', materiel.actual_user.pivot)">{{'MATERIELS.ACTION.RETURN-MATERIEL' | translate}}</button>
										</div>
									</ng-container>
									<ng-template #noUserInProgress>
										<div class="col-12">{{'MATERIELS.CARD.USER_TRACKING.NO_CURRENT_USER' | translate}}</div>
										<div class="col-12" *ngIf="materiel.main_categorie?.code != 'VEHICULE'">
											<button mat-raised-button class="btn-small pull-right" color="info" (click)="$event.stopPropagation(); openPretModal('add')">{{'MATERIELS.ACTION.ASSIGN_MATERIEL' | translate}}</button>
										</div>
									</ng-template>
								</div>
								<div class="row mt-2">
									<div class="col-12 my-2">
										<p><span class="label">{{'MATERIELS.PERSONNELS_HISTORY.TITLE' | translate}}</span></p>
									</div>
									<ng-container *ngIf="materiel.salaries.length > 0; else noArHistorique">
										<ng-container *ngFor="let salarie of materiel.salaries">
											<ng-container *ngIf="salarie.id != materiel.actual_user?.id">
												<div class="col-4">
													<p class="text-left">{{salarie | fullName}}</p>
												</div>
												<div class="col-3">
													<p class="text-center">{{'MATERIELS.READY.TITLE' | translate}} : {{salarie.pivot.date_pret | date:'dd/MM/yyyy'}}</p>
												</div>
												<div class="col-3">
													<p class="text-center">{{'MATERIELS.RETURN.TITLE' | translate}}: {{salarie.pivot.date_retour | date:'dd/MM/yyyy'}}</p>
												</div>
												<div class="col-2">
													<a class="pull-right" (click)="goToUserDetail(salarie.id)" matTooltip="{{'ACTION.SHOW_USER' | translate}}">
														<mat-icon color="primary">visibility</mat-icon>
													</a>
													<a *ngIf="materiel.main_categorie?.code != 'VEHICULE'" class="pull-right" (click)="$event.stopPropagation(); openPretModal('update', salarie.pivot)" matTooltip="{{'MATERIELS.ACTION.MODIFY_LOAN' | translate}}">
														<mat-icon color="accent">edit</mat-icon>
													</a>
												</div>
											</ng-container>
										</ng-container>
									</ng-container>
									<ng-template #noArHistorique>
										{{'MATERIELS.CARD.USER_TRACKING.NO_HISTORY' | translate}}
									</ng-template>
								</div>
							</ng-container>
							<ng-template #noSalaries>
								<div class="row">
									<div class="col-12">
										<p>{{'MATERIELS.CARD.USER_TRACKING.NO_LOAN' | translate}}</p>
									</div>
									<div class="col-12" *ngIf="materiel.main_categorie?.code != 'VEHICULE'">
										<button mat-raised-button color="info" class="btn-small" (click)="$event.stopPropagation(); openPretModal('add')">{{'MATERIELS.ACTION.ASSIGN_MATERIEL' | translate}}</button>
									</div>
								</div>
							</ng-template>
						</div>
					</div>
					
					<div class="card" *ngIf="materiel.has_controle">
						<div class="box box-ar-vs" style="flex: 1;">
							<h5><b>{{'MATERIELS.CARD.VISITE.TITLE' | translate}}</b><mat-icon color="primary" class="pull-right pointer" (click)="openRevisionModal()">edit</mat-icon></h5>
							<div class="box" style="flex:1">
								<p><span class="label pull-left mr-2">{{materiel.main_categorie?.code == 'BATIMENT' ? ('MATERIELS.CARD.VISITE.DATE_DERNIER_CONTROLE' | translate) : ('MATERIELS.CARD.VISITE.DATE_DERNIERE_REVISION' | translate)}}</span><span *ngIf="materiel.date_derniere_revision; else noData">{{materiel.date_derniere_revision | date:'dd/MM/yyyy'}}</span></p>
								<p><span class="label pull-left mr-2">{{materiel.main_categorie?.code == 'BATIMENT' ? ('MATERIELS.CARD.VISITE.DATE_PROCHAIN_CONTROLE' | translate) : ('MATERIELS.CARD.VISITE.DATE_PROCHAINE_REVISION' | translate)}}</span><span *ngIf="materiel.date_prochaine_revision; else noData">{{materiel.date_prochaine_revision | date:'dd/MM/yyyy'}}</span></p>
								<p><span class="label pull-left mr-2">{{materiel.main_categorie?.code == 'BATIMENT' ? ('MATERIELS.CARD.VISITE.PRESENCE_NC' | translate) : ('MATERIELS.CARD.VISITE.ETAT' | translate)}}</span><span *ngIf="materiel.etat || materiel.etat == 0; else noData">{{getEtat()}}</span></p>
								<p *ngIf="materiel.main_categorie?.code == 'BATIMENT'"><span class="label pull-left mr-2">{{'MATERIELS.CARD.VISITE.REVISION' | translate}}</span><span *ngIf="materiel.revision; else noData">{{materiel.revision}}</span></p>
								<p><span class="label pull-left mr-2">{{'MATERIELS.CARD.VISITE.COMMENT_REVISION' | translate}}</span><span *ngIf="materiel.comment_revision; else noData">{{materiel.comment_revision}}</span></p>
								<ng-template #noData>
									<span>-</span>
								</ng-template>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</tf-portlet-body>
</tf-portlet>