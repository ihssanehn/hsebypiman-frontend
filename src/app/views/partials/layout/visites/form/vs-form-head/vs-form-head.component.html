<tf-portlet-body>

    <div class="row">
        <div class="col-12 mb-2">
            <div class="tf-heading tf-heading--sm">
                <span *ngIf="origin != 'add'">{{'VISITES.VISIT_NO.TITLE' | translate}} {{visiteForm.get('code')?.value}}</span>
                <span *ngIf="origin == 'add'">{{'VISITES.ACTION.NEW_VISIT.TITLE' | translate}}</span>
                <span class="date-visite pull-right">
                    <small>{{'VISITES.REDACTEUR.LABEL' | translate}} : {{redacteur | fullName}} </small><br>
                    <small>{{'VISITES.DATE_VISITE.LABEL' | translate}} : {{visiteForm.get('date_visite')?.value}}</small>
                </span>
            </div>
        </div>
        <div class="col-12">
            <form [formGroup]="visiteForm" autocomplete="off" class="tf-form tf-form--group-seperator-dashed "
                novalidate fxLayout="column wrap" fxLayoutAlign="center center" fxLayoutGap="10px">
                <div class="tf-wizard-v4__content" data-tfwizard-type="step-content" data-tfwizard-state="current">
                    <div class="tf-form__section tf-form__section--first">
                        <div class="tf-wizard-v4__form">
                            <div class="row form-row">

                                <!-- SALARIE -->
                                <mat-form-field class="col-xl-3" *ngIf="origin == 'add' || formHasValue('salarie_id')"
                                    matTooltip="{{'VISITES.NOTIF.CANNOT_SELECT_EMPLOYEE.COMPANY_SELECTED.TITLE' | translate}}"
                                    [matTooltipDisabled]="formHasValue('salarie_id')">
                                    <mat-label>{{'VISITES.VISITED.LABEL' | translate}}</mat-label>
                                    <mat-select class="form-control" placeholder="" formControlName="salarie_id"
                                        [required]="isFieldRequired('salarie_id')">
                                        <mat-option *ngFor="let user of users" [value]="user.id">
                                            {{ user | fullName }}
                                        </mat-option>
                                    </mat-select>
                                    <button mat-button
                                        *ngIf="formHasValue('salarie_id') && !visiteForm.get('salarie_id').disabled"
                                        matSuffix mat-icon-button aria-label="Clear"
                                        (click)="clearValue('salarie_id'); $event.stopPropagation()">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <mat-error *ngIf="isControlHasError('salarie_id','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field>
                                

                                <!-- ENTREPRISE -->
                                <mat-form-field class="col-xl-3" 
                                    *ngIf="model == 'VsChantier' && (origin == 'add' || formHasValue('entreprise_id'))"
                                    matTooltip="{{ 'VISITES.NOTIF.CANNOT_SELECT_ENTREPRISE.TITLE' | translate }}" 
                                    [matTooltipDisabled]="formHasValue('entreprise_id')"
                                >
                                    <mat-label>{{'VISITES.ENTREPRISE.LABEL' | translate}}</mat-label>
                                    <mat-select class="form-control" placeholder="" formControlName="entreprise_id"
                                        [required]="isFieldRequired('entreprise_id')">
                                        <mat-optgroup *ngFor="let group of entreprisesGrouped;" [label]="group.name"
                                            [disabled]="group.disabled">
                                            <mat-option *ngFor="let entreprise of group.entreprises"
                                                [value]="entreprise.id">
                                                {{ entreprise.raison_sociale }}
                                            </mat-option>
                                        </mat-optgroup>
                                    </mat-select>
                                    <button mat-button
                                        *ngIf="formHasValue('entreprise_id') && !visiteForm.get('entreprise_id').disabled"
                                        matSuffix mat-icon-button aria-label="Clear"
                                        (click)="clearValue('entreprise_id'); $event.stopPropagation()">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <mat-error *ngIf="isControlHasError('entreprise_id','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field>


                                <!-- INTERIMAIRE -->
                                <mat-form-field class="col-xl-3" *ngIf="entHasCode() == 'INTERIM'">
                                    <mat-label>{{'EES.INTERIMAIRE.LABEL' | translate}}</mat-label>
                                    <mat-select class="form-control" formControlName="interimaire_id"
                                        [required]="isFieldRequired('interimaire_id')">
                                        <mat-option *ngFor="let user of interimairesList" [value]="user.id">
                                            {{ user | fullName }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="isControlHasError('interimaire_id','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field>

                                <!-- SOUS-TRAITANT NOM PRENOM -->
                                <mat-form-field class="col-xl-3" *ngIf="entHasCode() && entHasCode() != 'INTERIM'">
                                    <mat-label>Nom Pr√©nom</mat-label>
                                    <input type="text" matInput class="form-control" formControlName="nom_prenom"
                                        [required]="isFieldRequired('nom_prenom')">
                                    <mat-error *ngIf="isControlHasError('nom_prenom','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field>

                                <!-- TYPE -->
                                <mat-form-field class="col-xl-3">
                                    <mat-label>{{'VISITES.TYPE.LABEL' | translate}}</mat-label>
                                    <mat-select class="form-control" placeholder="" formControlName="type_id"
                                        [required]="isFieldRequired('type_id')">
                                        <mat-option *ngFor="let type of types" [value]="type.id">
                                            {{ type.libelle }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="isControlHasError('type_id','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field>

                                <!-- EPI -->
                                <mat-form-field class="col-xl-3" *ngIf="origin == 'detail' && formHasValue('visitable_id')"
                                    matTooltip="" [matTooltipDisabled]="formHasValue('visitable_id')">
                                    <mat-label>{{'OUTILLAGE.OUTIL.LABEL' | translate}}</mat-label>
                                    <mat-select class="form-control" placeholder="" formControlName="visitable_id"
                                        [required]="isFieldRequired('visitable_id')">
                                        <mat-option *ngFor="let materiel of materiels" [value]="materiel.id">
                                            <span *ngIf="model == 'VsVehicule'">
                                                {{materiel.numero_serie}}
                                            </span>
                                            <span *ngIf="model != 'VsVehicule'">
                                                {{ materiel.libelle+' - '+materiel.categorie.libelle }}
                                            </span>
                                        </mat-option>
                                    </mat-select>
                                    <button mat-button
                                        *ngIf="formHasValue('visitable_id') && !visiteForm.get('visitable_id').disabled"
                                        matSuffix mat-icon-button aria-label="Clear"
                                        (click)="clearValue('visitable_id'); $event.stopPropagation()">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <mat-error *ngIf="isControlHasError('visitable_id','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field>
                                <!-- OUTILLAGE -->
                                <!-- <mat-form-field class="col-xl-3" *ngIf="origin == 'detail' && formHasValue('outillage_code')"
                                    matTooltip=""
                                    [matTooltipDisabled]="formHasValue('outillage_code')">
                                    <mat-label>{{'OUTILLAGE.OUTIL.LABEL' | translate}}</mat-label>
                                    <mat-select class="form-control" placeholder="" formControlName="outillage_code"
                                        [required]="isFieldRequired('outillage_code')">
                                        <mat-option [value]="visiteForm.get('outillage_code').value">
                                            {{ visiteForm.get('outillage_code').value}}
                                        </mat-option>
                                    </mat-select>
                                    <button mat-button
                                        *ngIf="formHasValue('salarie_id') && !visiteForm.get('salarie_id').disabled"
                                        matSuffix mat-icon-button aria-label="Clear"
                                        (click)="clearValue('salarie_id'); $event.stopPropagation()">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <mat-error *ngIf="isControlHasError('salarie_id','required')">
                                        <strong>{{ 'AUTH.VALIDATION.REQUIRED_FIELD' | translate }}</strong>
                                    </mat-error>
                                </mat-form-field> -->
                                <mat-form-field class="col-xl-3 text-center" floatLabel="always" appearance="none" *ngIf="model != 'VsChantier'">
                                    <mat-slide-toggle formControlName="is_externe" [checked]="isExterne()" (change)="toggleExterne($event.checked)">
                                        <span class="slider-label">{{'VISITES.EXTERNAL_VISIT.TITLE' | translate}}</span>
                                    </mat-slide-toggle>
                                    <textarea matInput hidden></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</tf-portlet-body>